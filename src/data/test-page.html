<html>
<!-- Uploaded to: https://ctv.truex.com/kepler/test/test-page.html -->
<head>
  <title>TAR Test Page</title>
  <style>
      body {
          position: fixed;
          box-sizing: content-box;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: #2D2D32;
          overflow-y: hidden;
          text-align: left;
          margin: 0;
          padding: 0em;
          font: normal 20px Arial, Helvetica, sans-serif;
      }

      .msgs {
          box-sizing: border-box;
          position: absolute;
          bottom: 0;
          width: 100%;
          padding-left: 2em;
          padding-right: 2em;
      }

      pre {
          word-break: break-all;
          word-wrap: break-word;
          white-space: pre;
          white-space: -moz-pre-wrap;
          white-space: pre-wrap;
          padding: 0;
          margin: 0;
          line-height: 1;
          overflow-wrap: break-word;
          color: antiquewhite;
      }
  </style>
</head>
<body>
<div class="msgs" />
<script>
  (function() {
    const body = document.body;
    const msgsDiv = document.querySelector(".msgs");
    let scrollPos = 0;

    function scrollLog(direction, oldPos) {
      const pageH = body.clientHeight;
      const lineH = 20;
      const maxLines = Math.floor(pageH / lineH);
      const scrollStep = Math.floor(maxLines / 3) * lineH;

      const contentH = msgsDiv.clientHeight;

      const oldBottom = oldPos || scrollPos;
      let newBottom = oldBottom + scrollStep * direction;

      // Ensure we have margins away from the screen tops and bottoms.
      const maxBottom = 40;
      const minBottom = pageH - contentH - 20;

      if (contentH > pageH) {
        newBottom = Math.min(maxBottom, Math.max(minBottom, newBottom));
      } else {
        newBottom = minBottom;
      }
      msgsDiv.style.bottom = "" + newBottom + "px";
      scrollPos = newBottom;
    }

    const knownKeys = {
      home: 0,
      menu: 0,
      playPause: 0,
      fastForward: 0,
      rewind: 0,
      select: 13,
      space: 32,
      back: 27, // Esc
      left: 39,
      right: 37,
      up: 38,
      down: 40
    };

    function onKeyDown(event) {
      const keyCode = event.keyCode;
      let action = "unknown";
      for (keyAction in knownKeys) {
        if (knownKeys[keyAction] == keyCode) {
          action = keyAction;
          break;
        }
      }
      log(`key down: ${keyCode} - ${action}`);
      scrollLog(1);
    }

    body.addEventListener("keydown", onKeyDown);
    body.focus();

    function log(msg) {
      console.log(msg);
      var newMsg = document.createElement("pre");
      newMsg.innerText = msg;
      msgsDiv.append(newMsg);
    }

    scrollLog(0, 0);
    log("Note: Hit Back to exit");
  })();
</script>
</body>
</html>
